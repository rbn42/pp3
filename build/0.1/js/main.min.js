$(function(){function O(){var a=window.innerWidth,b=window.innerHeight,a=1280,b=720;a>b*h/f?n.setSize(b*h/f,b):n.setSize(a,a*f/h)}function P(a,b){a*=devicePixelRatio;b*=devicePixelRatio;I[0]=q[0]*(a/n.domElement.width-.5);I[1]=q[1]*(.5-b/n.domElement.height)}function ca(a){P(a.clientX,a.clientY)}function Q(a){1==a.touches.length&&(a.preventDefault(),P(a.touches[0].clientX,a.touches[0].clientY))}function p(a,b){for(i=0;i<a.length;i++)a[i]*=b}function R(){var a=Date.now();A+=a-S;for(S=a;A>1E3*y;)switch(A-=
1E3*y,a=y,vec2.copy(B[0],g),B[1]=I,t){case G:T(a);g[0]=0;g[1]=q[1]/2-r;g[2]=0;k.position.x=g[0];k.position.y=g[1];k.position.z=g[2];C.position.copy(k.position);H.position.copy(k.position);break;case J:m[3]*=Math.pow(Math.E,-da*a);u+=ea*a;K+=fa*a;vec3.cross(v,m,c);p(v,ga*r*a*m[3]);vec3.add(c,v,c);p(c,u/vec3.length(c));var b=[];vec3.copy(b,c);p(b,a);vec3.add(b,g,b);for(i=0;3>i;i++){var d=0,w=ha,f=[0,0,0];b[i]>q[i]/2-r?(2==i&&(U(z,g,D)?(w=V,vec2.subtract(f,z,W)):t=L),d=-1):b[i]<-q[i]/2+r&&(2==i&&(U(E,
g,D)?(w=V,vec2.subtract(f,E,X)):t=L),d=1);if(d){var e=[0,0,0];e[i]=d;var l=vec3.dot(c,e),h=[];vec3.copy(h,e);p(h,l);p(f,1/Y);var n=[];vec3.subtract(n,c,h);d=[];vec3.add(d,n,[0,0,0]);vec3.subtract(d,d,f);p(d,w*l);vec3.subtract(c,c,h);vec3.subtract(c,c,h);vec3.add(c,c,d);w=[];vec3.cross(w,d,e);p(w,ia);e=[];vec3.copy(e,m);p(e,m[3]);vec3.add(e,e,w);m[3]=vec3.length(e);vec3.normalize(m,e);p(c,u/vec3.length(c))}}vec3.copy(v,c);p(v,a);vec3.add(g,g,v);b=[];quat.setAxisAngle(b,m,m[3]);quat.multiply(s,s,b);
b=new THREE.Quaternion;b.set(s[0],s[1],s[2],s[3]);k.rotation.setFromQuaternion(b);k.position.x=g[0];k.position.y=g[1];k.position.z=g[2];C.position.copy(k.position);H.position.copy(k.position);T(a)}setTimeout(R,y)}function Z(a,b,d,c,f){c.length>2*Y/y&&(c.shift(),c.shift());for(var e=0;2>e;e++)c.push(a[e]);e=v;vec2.sub(e,b,a);b=f*d/vec2.length(e);1<b&&(b=1);p(e,b);vec2.add(a,a,e);for(e=0;2>e;e++)b=q[e]/2-D[e]/2,a[e]=a[e]>b?b:a[e],a[e]=a[e]<-b?-b:a[e]}function U(a,b,d){for(var c=0;2>c;c++)if(a[c]+d[c]<
b[c]||a[c]-d[c]>b[c])return!1;return!0}function T(a){Z(E,B[0],a,X,ja);Z(z,B[1],a,W,K);l[0].position.x=E[0];l[0].position.y=E[1];l[1].position.x=z[0];l[1].position.y=z[1]}function aa(){requestAnimationFrame(aa);n.render(x,M);F.update();switch(t){case J:var a;a="hsuiaaaaaaaaaaaaaaaaaaaaaaauh,ballSpeed:\\{0\\},\tballSpeedVector{1},ballSpinVector:{2}".format(u,c?vec3.str(c):0,m?vec4.str(m):0);$("#console").text(a)}}Detector.webgl||Detector.addGetWebGLMessage();screen.lockOrientation&&(screen.lockOrientation("portrait"),
alert(1));var x=new THREE.Scene,n=new THREE.WebGLRenderer({antialias:!0}),ba=document.getElementById("container"),F,M,k,C,I=vec2.fromValues(0,0),h=1/15*10,f=1/15*6,q=vec3.fromValues(h,f,1),r=.05*f,D=vec2.fromValues(.2*f,.2*f),d,N,l,B=[];(function(){O();var a=THREE.ImageUtils.loadTexture("images/bw.png");a.repeat.set(4,2);a.wrapS=a.wrapT=THREE.RepeatWrapping;a.anisotropy=16;var b=THREE.SmoothShading;N=[];N.push(new THREE.MeshPhongMaterial({map:a,bumpMap:a,bumpScale:1,color:16777215,ambient:15658734,
specular:14540253,shininess:50,shading:b}));a=new THREE.MeshBasicMaterial({});a=N[0];k=new THREE.Mesh(new THREE.SphereGeometry(1,32,32),a);k.scale.multiplyScalar(r);x.add(k);a=new THREE.SpriteMaterial({map:new THREE.ImageUtils.loadTexture("images/glow.png"),useScreenCoordinates:!1,color:7829367,transparent:!1,blending:THREE.AdditiveBlending});a=new THREE.Sprite(a);a.scale.set(4*r,4*r,4*r);k.add(a);a=new THREE.MeshPhongMaterial({color:6710886});l=[];var b=new THREE.PlaneGeometry(1,1),c=new THREE.MeshBasicMaterial({color:2289390,
transparent:!0,opacity:.5});for(i=0;2>i;i++)l[i]=new THREE.Mesh(b,c),x.add(l[i]),l[i].scale.y=D[1],l[i].scale.x=D[0],new THREE.Vector3;l[0].position.z=-.5;l[1].position.z=.5;b=new THREE.PlaneGeometry(1,1);d=[];for(i=0;4>i;i++)d[i]=new THREE.Mesh(b,a),x.add(d[i]);d[0].scale.x=1;d[1].scale.x=1;d[2].scale.y=1;d[3].scale.y=1;d[0].scale.y=f;d[1].scale.y=f;d[2].scale.x=h;d[3].scale.x=h;d[0].position.x=-h/2;d[1].position.x=h/2;d[2].position.y=-f/2;d[3].position.y=f/2;d[0].rotation.y=Math.PI/2;d[1].rotation.y=
3*Math.PI/2;d[2].rotation.x=3*Math.PI/2;d[3].rotation.x=Math.PI/2;a=new THREE.LineBasicMaterial({color:7829367});b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(-10,0,0));b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(10,0,0));b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(0,-10,0));b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(0,10,0));b.vertices.push(new THREE.Vector3(0,0,0));H=new THREE.Line(b,a);x.add(H);
M=new THREE.PerspectiveCamera(55,h/f,f/2-.1,10);M.position.z=.5+f/2/Math.tan(27.5/180*Math.PI);a=new THREE.AmbientLight(8947848);x.add(a);(new THREE.DirectionalLight(16777215,2)).position.set(0,0,1);C=new THREE.PointLight(13421772,.7,100);C.position.set(0,0,0);x.add(C);F=new Stats;F.domElement.style.position="absolute";F.domElement.style.top="0px";ba.appendChild(n.domElement);ba.appendChild(F.domElement);window.addEventListener("resize",O,!1);n.domElement.addEventListener("mousemove",ca,!1);n.domElement.addEventListener("touchstart",
Q,!1);n.domElement.addEventListener("touchmove",Q,!1)})();aa();var y=1/60;setTimeout(R,y);(function(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()})(document.body);var H;B[0]=[];new THREE.Vector3(1/6,1/7,.125);var c,g=vec3.fromValues(0,0,0),v=vec3.fromValues(0,0,0),m,u,K=2,ja=.2,A=0,S=Date.now(),G=1,J=2,L=3,t=G,E=vec3.fromValues(0,0,-q[2]/2),z=vec3.fromValues(0,
0,q[2]/2),s=vec4.fromValues(),ga=30,da=1,ea=.03,fa=.001,ha=.1,V=.6,ia=3,Y=.2,X=[],W=[];$("canvas").click(function(){switch(t){case G:console.log("start");u=.7;m=vec4.fromValues(1,0,0,0);s=quat.fromValues();quat.identity(s);c=[];vec3.subtract(c,z,g);p(c,u/vec3.length(c));t=J;break;case L:t=G}});c=[1,1,1,1]});
