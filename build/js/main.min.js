$(function(){function P(){var a=window.innerWidth,b=window.innerHeight,a=1280,b=720;a>b*h/f?m.setSize(b*h/f,b):m.setSize(a,a*f/h)}function Q(a,b){a*=devicePixelRatio;b*=devicePixelRatio;I[0]=q[0]*(a/m.domElement.width-.5);I[1]=q[1]*(.5-b/m.domElement.height)}function da(a){Q(a.clientX,a.clientY)}function R(a){1==a.touches.length&&(a.preventDefault(),Q(a.touches[0].clientX,a.touches[0].clientY))}function n(a,b){for(i=0;i<a.length;i++)a[i]*=b}function S(){var a=Date.now();A+=a-T;for(T=a;A>1E3*y;)switch(A-=
1E3*y,a=y,vec2.copy(B[0],g),B[1]=I,u){case G:U(a);g[0]=0;g[1]=q[1]/2-r;g[2]=0;k.position.x=g[0];k.position.y=g[1];k.position.z=g[2];C.position.copy(k.position);H.position.copy(k.position);break;case J:p[3]*=Math.pow(Math.E,-ea*a);v+=fa*a;K+=ga*a;vec3.cross(w,p,c);n(w,ha*r*a*p[3]);vec3.add(c,w,c);n(c,v/vec3.length(c));var b=[];vec3.copy(b,c);n(b,a);vec3.add(b,g,b);for(i=0;3>i;i++){var d=0,s=ia,f=[0,0,0];b[i]>q[i]/2-r?(2==i&&(V(z,g,D)?(s=W,vec2.subtract(f,z,X)):u=L),d=-1):b[i]<-q[i]/2+r&&(2==i&&(V(E,
g,D)?(s=W,vec2.subtract(f,E,Y)):u=L),d=1);if(d){M&&(M=!1,s=ja);var e=[0,0,0];e[i]=d;var l=vec3.dot(c,e),h=[];vec3.copy(h,e);n(h,l);n(f,1/Z);var m=[];vec3.subtract(m,c,h);d=[];vec3.add(d,m,[0,0,0]);vec3.subtract(d,d,f);n(d,s*l);vec3.subtract(c,c,h);vec3.subtract(c,c,h);vec3.add(c,c,d);s=[];vec3.cross(s,d,e);n(s,ka);e=[];vec3.copy(e,p);n(e,p[3]);vec3.add(e,e,s);p[3]=vec3.length(e);vec3.normalize(p,e);n(c,v/vec3.length(c))}}vec3.copy(w,c);n(w,a);vec3.add(g,g,w);b=[];quat.setAxisAngle(b,p,p[3]);quat.multiply(t,
t,b);b=new THREE.Quaternion;b.set(t[0],t[1],t[2],t[3]);k.rotation.setFromQuaternion(b);k.position.x=g[0];k.position.y=g[1];k.position.z=g[2];C.position.copy(k.position);H.position.copy(k.position);U(a)}setTimeout(S,y)}function aa(a,b,d,c,f){c.length>2*Z/y&&(c.shift(),c.shift());for(var e=0;2>e;e++)c.push(a[e]);e=w;vec2.sub(e,b,a);b=f*d/vec2.length(e);1<b&&(b=1);n(e,b);vec2.add(a,a,e);for(e=0;2>e;e++)b=q[e]/2-D[e]/2,a[e]=a[e]>b?b:a[e],a[e]=a[e]<-b?-b:a[e]}function V(a,b,d){for(var c=0;2>c;c++)if(a[c]+
d[c]<b[c]||a[c]-d[c]>b[c])return!1;return!0}function U(a){aa(E,B[0],a,Y,la);aa(z,B[1],a,X,K);l[0].position.x=E[0];l[0].position.y=E[1];l[1].position.x=z[0];l[1].position.y=z[1]}function ba(){requestAnimationFrame(ba);m.render(x,N);F.update();switch(u){case J:var a;a="hsuiaaaaaaaaaaaaaaaaaaaaaaauh,ballSpeed:\\{0\\},\tballSpeedVector{1},ballSpinVector:{2}".format(v,vec3.str(c),vec4.str(p));$("#console").text(a)}}Detector.webgl||Detector.addGetWebGLMessage();screen.lockOrientation&&(screen.lockOrientation("portrait"),
alert(1));var x=new THREE.Scene,m=new THREE.WebGLRenderer({antialias:!0}),ca=document.getElementById("container"),F,N,k,C,I=vec2.fromValues(0,0),h=1/15*10,f=1/15*6,q=vec3.fromValues(h,f,1),r=.05*f,D=vec2.fromValues(.2*f,.2*f),d,O,l,B=[];(function(){P();var a=THREE.ImageUtils.loadTexture("images/moon_1024.jpg");a.wrapS=a.wrapT=THREE.RepeatWrapping;a.anisotropy=16;a=THREE.ImageUtils.loadTexture("images/bw.bmp");a.repeat.set(4,2);a.wrapS=a.wrapT=THREE.RepeatWrapping;a.anisotropy=16;var b=THREE.SmoothShading;
O=[];O.push(new THREE.MeshPhongMaterial({map:a,bumpMap:a,bumpScale:1,color:16777215,ambient:15658734,specular:14540253,shininess:50,shading:b}));a=new THREE.MeshBasicMaterial({});a=O[0];k=new THREE.Mesh(new THREE.SphereGeometry(1,32,32),a);k.scale.multiplyScalar(r);x.add(k);a=new THREE.SpriteMaterial({map:new THREE.ImageUtils.loadTexture("images/glow.png"),useScreenCoordinates:!1,color:7829367,transparent:!1,blending:THREE.AdditiveBlending});a=new THREE.Sprite(a);a.scale.set(4*r,4*r,4*r);k.add(a);
a=new THREE.MeshPhongMaterial({color:6710886});l=[];var b=new THREE.PlaneGeometry(1,1),c=new THREE.MeshBasicMaterial({color:2289390,transparent:!0,opacity:.5});for(i=0;2>i;i++)l[i]=new THREE.Mesh(b,c),x.add(l[i]),l[i].scale.y=D[1],l[i].scale.x=D[0],new THREE.Vector3;l[0].position.z=-.5;l[1].position.z=.5;b=new THREE.PlaneGeometry(1,1);d=[];for(i=0;4>i;i++)d[i]=new THREE.Mesh(b,a),x.add(d[i]);d[0].scale.x=1;d[1].scale.x=1;d[2].scale.y=1;d[3].scale.y=1;d[0].scale.y=f;d[1].scale.y=f;d[2].scale.x=h;d[3].scale.x=
h;d[0].position.x=-h/2;d[1].position.x=h/2;d[2].position.y=-f/2;d[3].position.y=f/2;d[0].rotation.y=Math.PI/2;d[1].rotation.y=3*Math.PI/2;d[2].rotation.x=3*Math.PI/2;d[3].rotation.x=Math.PI/2;a=new THREE.LineBasicMaterial({color:7829367});b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(-10,0,0));b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(10,0,0));b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(0,-10,0));b.vertices.push(new THREE.Vector3(0,
0,0));b.vertices.push(new THREE.Vector3(0,10,0));b.vertices.push(new THREE.Vector3(0,0,0));H=new THREE.Line(b,a);x.add(H);N=new THREE.PerspectiveCamera(55,h/f,f/2-.1,10);N.position.z=.5+f/2/Math.tan(27.5/180*Math.PI);a=new THREE.AmbientLight(8947848);x.add(a);(new THREE.DirectionalLight(16777215,2)).position.set(0,0,1);C=new THREE.PointLight(13421772,.7,100);C.position.set(0,0,0);x.add(C);F=new Stats;F.domElement.style.position="absolute";F.domElement.style.top="0px";ca.appendChild(m.domElement);
ca.appendChild(F.domElement);window.addEventListener("resize",P,!1);m.domElement.addEventListener("mousemove",da,!1);m.domElement.addEventListener("touchstart",R,!1);m.domElement.addEventListener("touchmove",R,!1)})();ba();var y=1/60;setTimeout(S,y);(function(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()})(document.body);var H;B[0]=[];new THREE.Vector3(1/
6,1/7,.125);var c,g=vec3.fromValues(0,0,0),w=vec3.fromValues(0,0,0),p,v,K=2,la=.2,A=0,T=Date.now(),G=1,J=2,L=3,u=G,E=vec3.fromValues(0,0,-q[2]/2),z=vec3.fromValues(0,0,q[2]/2),t=vec4.fromValues(),ha=30,ea=1,fa=.03,ga=.001,ia=.1,W=.6,ja=.6,ka=3,Z=.2,Y=[],X=[],M;$("canvas").click(function(){switch(u){case G:console.log("start");v=.7;M=!0;p=vec4.fromValues(1,0,0,0);t=quat.fromValues();quat.identity(t);c=[];vec3.subtract(c,z,g);n(c,v/vec3.length(c));u=J;break;case L:u=G}});c=[1,1,1,1]});
